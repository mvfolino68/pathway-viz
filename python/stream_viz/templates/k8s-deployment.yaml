# StreamViz Kubernetes Deployment
#
# Usage:
#   kubectl apply -f k8s-deployment.yaml
#   kubectl apply -f k8s-service.yaml
#   kubectl apply -f k8s-ingress.yaml  # Optional, for external access
#
# Prerequisites:
#   - Build and push your image: docker build -t your-registry/streamviz:v1 . && docker push ...
#   - Create the configmap: kubectl create configmap streamviz-config --from-literal=kafka_servers=kafka:9092

apiVersion: apps/v1
kind: Deployment
metadata:
  name: streamviz
  labels:
    app: streamviz
spec:
  replicas: 1
  selector:
    matchLabels:
      app: streamviz
  template:
    metadata:
      labels:
        app: streamviz
    spec:
      containers:
        - name: streamviz
          image: your-registry/streamviz:latest
          ports:
            - containerPort: 3000
              name: http
          env:
            - name: KAFKA_BOOTSTRAP_SERVERS
              valueFrom:
                configMapKeyRef:
                  name: streamviz-config
                  key: kafka_servers
            - name: STREAMVIZ_PORT
              value: "3000"
          resources:
            requests:
              cpu: 500m
              memory: 512Mi
            limits:
              cpu: 2000m
              memory: 2Gi
          livenessProbe:
            httpGet:
              path: /
              port: 3000
            initialDelaySeconds: 10
            periodSeconds: 30
          readinessProbe:
            httpGet:
              path: /
              port: 3000
            initialDelaySeconds: 5
            periodSeconds: 10
          volumeMounts:
            - name: data
              mountPath: /app/data
      volumes:
        - name: data
          persistentVolumeClaim:
            claimName: streamviz-pvc
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: streamviz-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
